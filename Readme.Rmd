---
title: Exametrika
output: github_document
---

# Exametrika

The Exametrika package is designed for test data engineering and corresponds to the text by Shojima (2022). Test data engineering involves analyzing test response patterns to classify item difficulty and respondent ranking. This analysis includes the following test theory models.

+ Classical Test Theory
+ Item response theory: 2PL, 3PL, 4PL model
+ Latent Class Analysis
+ Latent Rnak Analysis
+ Biclustering and Ranklustering
+ Infinite Relational Model for optimal number of classes and fields
+ Bayesian Network Analysis
+ Structure Learning for Bayesian Network Analysis by Genetic Algorithm

The estimation of the optimal number of ranks using the Chinese Restaurant Process algorithm has not yet been implemented. Additionally, the following models are also planned to be implemented, but are not yet available.

+ Local Dependence Latent Rank Analysis
+ Local Dependence Biclustering
+ Biclister Network Model

Exametrika is originally implemented and published as a Mathematica and Excel Add-in. Please refer to the following website for more information.

[Accompanying Website for Test Data Engineering](http://shojima.starfree.jp/tde/)

## Installation

You can install the development version of Exametrika from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("kosugitti/Exametrika")
```

## Example and Sample Data

This package includes the same sample data that is distributed on the original site. The number of test-takers is represented by \( S \), and the number of test items is represented by \( J \). The data is named in a format like JxxSxxx.

### Exametrika Data Format

Exametrika conducts analysis on data matrices composed solely of 0 or 1. In this matrix, 0 represents an incorrect answer, and 1 indicates a correct answer.For more details, refer to Shojima (2022) regarding the format.

### Data Matrix Format

- The data matrix must be in a matrix or data frame format.
- It's permissible to include NA as missing values.
- Specific values (for instance, -99) can be designated as missing values.
- Along with the data, you may also provide a missing value index matrix that discerns the presence or absence of missing values.

### Examinee ID Column

It is possible to incorporate a column of examinee IDs into the data matrix you provide. By default, the first column is presumed to be the examinee ID column.

### Item Weight Vector

Item weights can be specified by the item weight vector, w. If not given, all elements' weights are set to 1.

### Item label Vector

Data column names (colnames) are available as item labels. If not specified, a sequential number is assigned.

### Data Formatting Function

Before any analysis, the dataFormat function decomposes the provided data into an ID vector,Item label vector, data matrix U, missing value index matrix Z, and item weight vector w.


## CTT Example

```{r}
library(Exametrika)
CTT(J15S500)
```

## IRT Example

The IRT function estimates the number of parameters using a logistic model, which can be specified using the `model` option. It supports 2PL, 3PL, and 4PL models.

```{r}
result.IRT <- IRT(J15S500, model = 3)
result.IRT
```

The estimated population of subjects is included in the returned object.
```{r}
head(result.IRT$ability)
```


The plots offer options for Item Characteristic Curves (ICC), Item Information Curves (IIC), and Test Information Curves (TIC), which can be specified through options. Items can be specified using the `items` argument, and if not specified, plots will be drawn for all items. The number of rows and columns for dividing the plotting area can be specified using `nr` and `nc`, respectively.

```{r}
plot(result.IRT, type = "ICC", items = 1:6, nc = 2, nr = 3)
plot(result.IRT, type = "IIC", items = 1:6, nc = 2, nr = 3)
plot(result.IRT, type = "TIC")
```

## LCA Example

Latent Class Analysis requires specifying the dataset and the number of classes.

```{r}
LCA(J15S500, ncls = 5)
```

The returned object contains the Class Membership Matrix, which indicates which latent class each subject belongs to. The Estimate includes the one with the highest membership probability.

```{r}
result.LCA <- LCA(J15S500, ncls = 5)
head(result.LCA$Students)
```

The plots offer options for IRP, CMP, TRP, and LCD. For more details on each, please refer to Shojima (2022).

```{r}
plot(result.LCA, type = "IRP", items = 1:6, nc = 2, nr = 3)
plot(result.LCA, type = "CMP", students = 1:9, nc = 3, nr = 3)
plot(result.LCA, type = "TRP")
plot(result.LCA, type = "LCD")
```

## LRA Example

Latent Class Analysis requires specifying the dataset and the number of classes.

```{r}
LRA(J15S500, ncls = 6)
```

The estimated subject rank membership probabilities and plots are almost the same as those in LCA (Latent Class Analysis). Since a ranking is assumed for the latent classes, rank-up odds and rank-down odds are calculated.

```{r}
result.LRA <- LRA(J15S500, ncls = 6)
head(result.LRA$Students)
```

```{r}
plot(result.LRA, type = "IRP", items = 1:6, nc = 2, nr = 3)
plot(result.LRA, type = "CMP", students = 1:9, nc = 3, nr = 3)
plot(result.LRA, type = "TRP")
plot(result.LRA, type = "LCD")
```

## Biclustering Example

Biclustering and Ranklustering algorithms are almost the same, differing only in whether they include a filtering matrix or not. The difference is specified using the `method` option in the `Biclustering()` function. For more details, please refer to the help documentation.

```{r}
Biclustering(J35S515, nfld = 5, ncls = 6, method = "B")
```


```{r}
result.Ranklusteing <- Biclustering(J35S515, nfld = 5, ncls = 6, method = "R")
plot(result.Ranklusteing, type = "Array")
plot(result.Ranklusteing, type = "FRP", nc = 2, nr = 3)
plot(result.Ranklusteing, type = "RMP", students = 1:9, nc = 3, nr = 3)
plot(result.Ranklusteing, type = "LRD")
```

To find the optimal number of classes and the optimal number of fields, the Infinite Relational Model is available.

```{r}
result.IRM <- IRM(J35S515, gamma_c = 1, gamma_f = 1, verbose = TRUE)
plot(result.IRM, type = "Array")
plot(result.IRM, type = "FRP", nc = 3)
plot(result.IRM, type = "TRP")
plot(result.IRM, type = "LCD")
```

## Bayesian Network Model
The Bayesian network model is a model that represents the conditional probabilities between items in a network format based on the pass rates of the items. By providing a Directed Acyclic Graph (DAG) between items externally, it calculates the conditional probabilities based on the specified graph. The igraph package is used for the analysis and representation of the network.

For example, by using igraph package, you can create DAG object as follows:

```{r igraph}
library(igraph)
DAG <-
  matrix(
    c(
      "Item01", "Item02",
      "Item02", "Item03",
      "Item02", "Item04",
      "Item03", "Item05",
      "Item04", "Item05"
    ),
    ncol = 2, byrow = T
  )
g <- igraph::graph_from_data_frame(DAG)
```

It is also possible to provide the graph in a CSV file. The labels attached to the nodes of the graph must be included in the item labels of the dataset.

A CSV file with the same information as the graph above in the following format. The first line contains column names (headers) and will not be read as data.


```{r echo=FALSE}
file_path <- "develop/EdgesBNM_R.csv"

lines <- readLines(file_path)
for (line in lines) {
  print(line)
}
```



An example of executing BNM by providing a graph structure (DAG) is as follows:

```{r BNM}
result.BNM <- BNM(J5S10, DAG = g)
result.BNM
```
### Structure Larning for Bayesian network with GA

The function searches for a DAG suitable for the data using a genetic algorithm. A best DAG is not necessarily identified. Instead of exploring all combinations of nodes and edges, only the space topologically sorted by the pass rate, namely the upper triangular matrix of the adjacency matrix, is explored. For interpretability, the number of parent nodes should be limited. A null model is not proposed. Utilize the content of the items and the experience of the questioner to aid in interpreting the results. For more details, please refer to Section 8.5 of the text(Shojima,2022).

Please note that the GA may take a considerable amount of time, depending on the number of items and the size of the population.

```{r GAsimple}
StrLearningGA(J5S10,
  population = 20, Rs = 0.5, Rm = 0.002, maxParents = 2,
  maxGeneration = 100, crossover = 2, elitism = 2
)
```

The method of Population-based incremental learning proposed by Fukuda (2014) can also be used for learning. This method has several variations for estimating the optimal adjacency matrix at the end, which can be specified as options. See help or text Section 8.5.2.

```{r PBIL}
StrLearningPBIL(J5S10,
  population = 20, Rs = 0.5, Rm = 0.005, maxParents = 2,
  alpha = 0.05, estimate = 4
)
```


## Reference

Shojima, Kojiro (2022) Test Data Engineering: Latent Rank Analysis, Biclustering, and Bayesian Network (Behaviormetrics: Quantitative Approaches to Human Behavior, 13),Springer, [https://amzn.to/42eNArd](https://amzn.to/42eNArd)
